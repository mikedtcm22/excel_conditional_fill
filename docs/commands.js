(()=>{"use strict";function r(r){alert(r)}function e(r){switch(r){case"blanks":return"No blank cells found in selection";case"errors":return"No error cells found in selection";case"both":return"No blank or error cells found in selection";default:return"No eligible cells found in selection"}}function o(r,e){return!(null!=r&&""!==r||""!==e&&null!==e)}function t(r){return null!=r&&("string"==typeof r?/^#(N\/A|VALUE!|REF!|DIV\/0!|NUM!|NAME\?|NULL!)$/.test(r):"object"==typeof r&&void 0!==r.errorType)}function n(r,e,n){return"blanks"===n?o(r,e):"errors"===n?t(r):"both"===n&&(o(r,e)||t(r))}async function c(r){try{const o=await async function(r){try{return await Excel.run(async e=>{let o;if("activeCell"===r)o=e.workbook.getActiveCell();else{if("topLeft"!==r)return{valid:!1,error:`Invalid template source: ${r}`};o=e.workbook.getSelectedRange().getCell(0,0)}o.load("formulasR1C1"),await e.sync();const t=o.formulasR1C1[0][0];return t&&""!==t?{valid:!0}:{valid:!1,error:"Active cell must contain a formula"}})}catch(r){return console.error("Error during preflight validation:",r),{valid:!1,error:r instanceof Error?r.message:"Validation error occurred"}}}(r.templateSource);if(!o.valid)return{modifiedCount:0,success:!1,error:o.error};const t=await async function(r){try{return await Excel.run(async e=>{const o=await async function(r,e){let o;if("activeCell"===e)o=r.workbook.getActiveCell();else{if("topLeft"!==e)throw new Error(`Invalid template source: ${e}`);o=r.workbook.getSelectedRange().getCell(0,0)}return o.load("formulasR1C1"),o}(e,r),t=await async function(r,e){e.load("formulasR1C1"),await r.sync();const o=e.formulasR1C1[0][0];if(!o||""===o)throw new Error("Active cell must contain a formula");return o}(e,o);return{cell:o,formulaR1C1:t}})}catch(r){throw console.error("Error detecting template formula:",r),r}}(r.templateSource),c=await async function(r){try{return await Excel.run(async e=>{const o=e.workbook.getSelectedRange();o.load("values, formulas, rowCount, columnCount"),await e.sync();const t=[];for(let e=0;e<o.rowCount;e++)for(let c=0;c<o.columnCount;c++)n(o.values[e][c],o.formulas[e][c],r)&&t.push({row:e,col:c});return t})}catch(r){throw console.error("Error identifying eligible cells:",r),r}}(r.targetCondition);if(0===c.length)return{modifiedCount:0,success:!1,error:e(r.targetCondition)};const l=await async function(r,e){if(0===r.length)return 0;try{return await Excel.run(async o=>{const t=o.workbook.getSelectedRange();for(const o of r)t.getCell(o.row,o.col).formulasR1C1=[[e]];return await o.sync(),r.length})}catch(r){throw console.error("Error writing formulas to eligible cells:",r),r}}(c,t.formulaR1C1);return{modifiedCount:l,success:!0}}catch(r){return console.error("Error executing fill operation:",r),{modifiedCount:0,success:!1,error:r instanceof Error?r.message:"Unknown error occurred"}}}async function l(e){try{const e=await c({templateSource:"activeCell",targetCondition:"blanks"});!e.success&&e.error&&r(e.error)}catch(e){r("An unexpected error occurred"),console.error("Fill Blanks command error:",e)}finally{e.completed()}}async function a(e){try{const e=await c({templateSource:"activeCell",targetCondition:"errors"});!e.success&&e.error&&r(e.error)}catch(e){r("An unexpected error occurred"),console.error("Fill Errors command error:",e)}finally{e.completed()}}Office.onReady(()=>{console.log("FillGaps commands loaded"),Office.actions.associate("fillBlanksCommand",l),Office.actions.associate("fillErrorsCommand",a)})})();